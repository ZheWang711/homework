# 250b-hw3

##Question 5

(A) 

* Create the validation set: randomly pick 10000 images from the test data set, the validation set will be used to compute $$c$$.
* Prediction rule: let $$X$$ be the set of images, and $$Y$$ be the the class, the prediction rule will be: $$argmax_t(P(y=t|x))$$.


**Pseudo code:**

* Randomly choose 10000 images from test data as validation set.
* **First train**: train the model based on the remaining 50000 images of the test set.
    * For each digit $$i$$, let $$X^{(i)}$$ be its corresponding images ($$X^{(i)}$$ is a matrix, each row of it is an image vector, and each column of $$X^{(i)}$$ corresponds with a particular pixel), $$m$$ is the number of rows in that matrix (the number of images corresponding with digit $$i$$).
        * compute $$\mu = \frac{\text{sum of col}(X^{(i)})}{m}$$.
        * compute covariance matrix $$\Sigma = \frac{X^{(i)T}X^{(i)}}{m}$$

* **validate**(c): try different values of c, find out the one with smallest error rate.
    * $$\Sigma' = \Sigma + cI$$
    * Since  
    $$argmax_y{P(y|x)} = argmax\frac{P(x|y)P(y)}{P(x)} = argmax_y\{logP(x|y)) + logP(y)\} $$.  
    Then for each digit i, compute its corresponding log-probability predict the one whose value is the largest:
        * $$logP(x|y)=-\frac{p*log(2\pi)}{2} - \frac{log\Sigma'}{2} - \frac{1}{2}(x-\mu)^T\Sigma^{'-1}(x-\mu)$$
        * $$logP(y) = log\frac{\text{num of digit i}}{\text{length of train set}}$$
        
    * compare the prediction with the correct label
    * compute and return the error rate



* **Second Train:** By performing several above validation process, let $$cc$$ be the one with smallest validate error.
    * Instead of using the remaining 50000 training data, use the entire 60000 training data at this time.
        * For each digit $$i$$, let $$X^{'(i)}$$ be its corresponding images, $$m'$$ is the number of rows in that matrix (the number of images corresponding with digit $$i$$)
    * compute $$\mu = \frac{\text{sum of col}(X^{'(i)})}{m'}$$.
    * compute covariance matrix $$\Sigma = \frac{X^{'(i)T}X^{'(i)}}{m'} + ccI$$

(B)

Validation error vs. $$c$$

![](Unknown-7)

Thus we choose $$c$$ as $$3000$$, and the test error is $$4.447\%$$

(C)

**Instance 1:**
* Display
prediction: 3
answer: 2


![](Unknown)

* Posterior probability

| $$y$$ | $$P(y|x)$$ |
| -- | -- |
| 0 | 3.166511770469642e-12 |
| 1 | 4.3364505260927414e-89 |
| 2 | 0.0014696796995697535 |
| 3 | 0.9985303202829148 |
| 4 | 1.187052411384596e-54 |
| 5 | 3.234767760880538e-19 |
| 6 | 1.2837938589609495e-32 |
| 7 | 7.682465562235285e-89 |
| 8 | 1.4083727171727586e-11 |
| 9 | 5.541401348615013e-53 |

 
**Instance 2:** 

* Display
prediction: 1
answer: 6

![](Unknown-3)

* Posterior probability

| $$y$$ | $$P(y|x)$$ |
| -- | -- |
| 0 | 4.5023674503345905e-40 |
| 1 | 0.9999999994633981 |
| 2 | 3.340665260505071e-28 |
| 3 | 8.300759794627006e-26 |
| 4 | 2.9096611592167635e-32 |
| 5 | 4.81008806109596e-30 |
| 6 | 5.368882466313778e-10 |
| 7 | 3.2638073863665774e-54 |
| 8 | 6.739059102297456e-19 |
| 9 | 2.3570264779094618e-55 |

**Instance 3**
* Display prediction: 1
answer: 7

![](Unknown-4)

* Posterior probability

| $$y$$ | $$P(y|x)$$ |
| -- | -- |
| 0 | 1.0233792246126153e-52 |
| 1 | 1.0 |
| 2 | 4.7190567449808085e-32 |
| 3 | 3.065794765662978e-32 |
| 4 | 8.838139931691335e-21 |
| 5 | 1.0398698386711265e-42 |
| 6 | 1.8328455531772348e-44 |
| 7 | 8.455274384606583e-23 |
| 8 | 1.4474168812517608e-23 |
| 9 | 9.489867784174749e-21 |

**Instance 4**
* Display 
prediction: 9
answer: 7

![](Unknown-5)

* Posterior probability

| $$y$$ | $$P(y|x)$$ |
| -- | -- |
| 0 | 6.793497595605238e-42 |
| 1 | 0.0001857910175701127 |
| 2 | 1.717235990062993e-19 |
| 3 | 1.597815440140409e-17 |
| 4 | 4.0581136092398094e-08 |
| 5 | 2.85919290904734e-32 |
| 6 | 2.5307714742683292e-45 |
| 7 | 0.5046274381331205 |
| 8 | 2.0615794929620745e-11 |
| 9 | 0.4951867302474461 |
**Instance 5**

* Display 
prediction: 2
answer: 9

![](Unknown-6)
* Posterior probability

| $$y$$ | $$P(y|x)$$ |
| -- | -- |
| 0 | 1.3861638707072283e-12 |
| 1 | 1.7635675791641236e-250 |
| 2 | 0.9999999996662154 |
| 3 | 3.315387139741261e-10 |
| 4 | 2.181639533586354e-65 |
| 5 | 1.5289906019095007e-12 |
| 6 | 1.1664111968086499e-75 |
| 7 | 1.6493566228409604e-61 |
| 8 | 1.13597837384623e-19 |
| 9 | 1.3809569394481843e-26 |